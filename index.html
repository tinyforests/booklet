<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Field Guide — Gardener & Son</title>
  <style>
    /* ========================================
       RESET
       ======================================== */
    
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* ========================================
       DESIGN TOKENS
       ======================================== */
    
    :root {
      /* Typography */
      --font-serif: 'Iowan Old Style', 'Palatino Linotype', 'Palatino', 'Book Antiqua', Georgia, serif;
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      
      /* Type scale — responsive */
      --text-xl: clamp(2.5rem, 6vw, 4rem);      /* Entry title */
      --text-lg: clamp(1.5rem, 3.5vw, 2.25rem); /* Slide headings */
      --text-md: clamp(1.0625rem, 2vw, 1.25rem);/* Body text */
      --text-sm: 0.75rem;                       /* Footer */
      
      /* Line heights */
      --line-tight: 1.15;
      --line-medium: 1.4;
      --line-relaxed: 1.65;
      
      /* Colors — restrained */
      --color-text: #1a1a1a;
      --color-bg: #fefefe;
      --color-subtle: rgba(26, 26, 26, 0.25);
      --color-divider: rgba(26, 26, 26, 0.1);
      
      /* Spacing */
      --space-page: clamp(2rem, 8vw, 6rem);
      
      /* Motion — physical, slight resistance */
      --ease-slide: cubic-bezier(0.4, 0.0, 0.2, 1);
      --duration-slide: 650ms;
    }
    
    /* ========================================
       BASE STYLES
       ======================================== */
    
    html {
      font-size: 100%;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      font-family: var(--font-sans);
      font-size: var(--text-md);
      line-height: var(--line-relaxed);
      color: var(--color-text);
      background: var(--color-bg);
      overflow: hidden;
    }
    
    /* ========================================
       SLIDES CONTAINER
       ======================================== */
    
    #slides-container {
      display: flex;
      height: 100vh;
      width: 100vw;
      transition: transform var(--duration-slide) var(--ease-slide);
      will-change: transform;
    }
    
    /* ========================================
       INDIVIDUAL SLIDE
       ======================================== */
    
    .slide {
      min-width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: var(--space-page);
    }
    
    .slide__content {
      max-width: 38rem; /* ~70 characters at body size */
      width: 100%;
    }
    
    /* Entry slide — centered */
    .slide--entry {
      text-align: center;
    }
    
    .slide--entry .slide__content {
      max-width: 28rem;
    }
    
    /* ========================================
       TYPOGRAPHY
       ======================================== */
    
    h1 {
      font-family: var(--font-serif);
      font-size: var(--text-xl);
      font-weight: 400;
      line-height: var(--line-tight);
      letter-spacing: -0.02em;
      margin-bottom: 2rem;
    }
    
    h2 {
      font-family: var(--font-serif);
      font-size: var(--text-lg);
      font-weight: 400;
      line-height: var(--line-medium);
      letter-spacing: -0.015em;
      margin-bottom: 1.5rem;
    }
    
    p {
      font-family: var(--font-sans);
      font-size: var(--text-md);
      line-height: var(--line-relaxed);
      margin-bottom: 1rem;
    }
    
    p:last-child {
      margin-bottom: 0;
    }
    
    /* Line breaks in content */
    .line-break {
      display: block;
      height: 0.75em;
    }
    
    /* ========================================
       ENTER BUTTON (Entry slide only)
       ======================================== */
    
    .enter-button {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.75rem 2rem;
      font-family: var(--font-sans);
      font-size: var(--text-md);
      color: var(--color-text);
      background: transparent;
      border: 1px solid var(--color-text);
      cursor: pointer;
      transition: all 200ms ease;
    }
    
    .enter-button:hover {
      background: var(--color-text);
      color: var(--color-bg);
    }
    
    .enter-button:focus {
      outline: 2px solid var(--color-text);
      outline-offset: 4px;
    }
    
    /* ========================================
       NAVIGATION ARROWS
       ======================================== */
    
    #nav-arrows {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 1.5rem;
      opacity: 0.25;
      transition: opacity 300ms ease;
      z-index: 100;
    }
    
    #nav-arrows:hover,
    #nav-arrows:focus-within {
      opacity: 1;
    }
    
    #nav-arrows button {
      width: 2.5rem;
      height: 2.5rem;
      background: none;
      border: 1px solid var(--color-text);
      border-radius: 50%;
      color: var(--color-text);
      font-size: 1rem;
      cursor: pointer;
      transition: all 200ms ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #nav-arrows button:hover {
      background: var(--color-text);
      color: var(--color-bg);
    }
    
    #nav-arrows button:disabled {
      opacity: 0.15;
      cursor: not-allowed;
      pointer-events: none;
    }
    
    #nav-arrows button:focus {
      outline: 2px solid var(--color-text);
      outline-offset: 4px;
    }
    
    /* ========================================
       PROGRESS INDICATOR
       ======================================== */
    
    #progress-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 1px;
      background: var(--color-divider);
      z-index: 100;
    }
    
    #progress-bar {
      height: 100%;
      background: var(--color-text);
      width: 0%;
      transition: width var(--duration-slide) var(--ease-slide);
    }
    
    /* ========================================
       FOOTER (Minimal, persistent)
       ======================================== */
    
    #footer {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: var(--text-sm);
      color: var(--color-subtle);
      text-align: center;
      opacity: 0.5;
      z-index: 50;
      pointer-events: none;
    }
    
    #footer p {
      margin: 0;
      line-height: 1.4;
    }
    
    /* ========================================
       ACCESSIBILITY
       ======================================== */
    
    @media (prefers-reduced-motion: reduce) {
      #slides-container,
      #progress-bar,
      .enter-button,
      #nav-arrows button {
        transition: none;
      }
    }
    
    /* ========================================
       MOBILE REFINEMENTS
       ======================================== */
    
    @media (max-width: 640px) {
      .slide {
        padding: 2rem 1.5rem;
        justify-content: flex-start;
        padding-top: 4rem;
      }
      
      #nav-arrows {
        bottom: 1.5rem;
        gap: 1rem;
      }
      
      #nav-arrows button {
        width: 2.25rem;
        height: 2.25rem;
      }
      
      #footer {
        bottom: 5rem; /* Above navigation */
      }
    }
  </style>
</head>
<body>

  <!-- Main slides container -->
  <main id="slides-container" role="main">
    <!-- Slides injected here by JavaScript -->
  </main>

  <!-- Minimal navigation arrows -->
  <nav id="nav-arrows" aria-label="Slide navigation">
    <button id="prev-slide" aria-label="Previous slide" disabled>←</button>
    <button id="next-slide" aria-label="Next slide">→</button>
  </nav>

  <!-- Progress indicator -->
  <div id="progress-indicator" role="progressbar" aria-label="Reading progress">
    <div id="progress-bar"></div>
  </div>

  <!-- Minimal footer -->
  <footer id="footer">
    <p>© Gardener & Son<br>Made slowly</p>
  </footer>

  <script>
    // ========================================
    // FIELD GUIDE — SLIDE NAVIGATION
    // Simple, durable, no dependencies
    // ========================================
    
    let currentSlide = 0;
    let totalSlides = 0;
    let isAnimating = false;
    let slidesData = [];
    
    // ========================================
    // INITIALIZATION
    // ========================================
    
    async function init() {
      try {
        const response = await fetch('content/slides.json');
        const data = await response.json();
        slidesData = data.slides;
        totalSlides = slidesData.length;
        
        buildSlides(slidesData);
        setupNavigation();
        updateNavState();
        updateProgress();
        
      } catch (error) {
        console.error('Failed to load slides:', error);
        document.getElementById('slides-container').innerHTML = 
          '<div class="slide"><div class="slide__content"><p>Failed to load content. Please refresh.</p></div></div>';
      }
    }
    
    // ========================================
    // BUILD SLIDE DOM ELEMENTS
    // ========================================
    
    function buildSlides(slides) {
      const container = document.getElementById('slides-container');
      container.innerHTML = ''; // Clear any existing content
      
      slides.forEach((slide, index) => {
        const slideEl = document.createElement('section');
        slideEl.className = 'slide';
        slideEl.setAttribute('data-slide-index', index);
        slideEl.setAttribute('aria-label', `Slide ${index + 1} of ${slides.length}`);
        
        // Add type class if specified
        if (slide.type) {
          slideEl.classList.add(`slide--${slide.type}`);
        }
        
        const content = document.createElement('div');
        content.className = 'slide__content';
        
        // Entry slide with title and button
        if (slide.type === 'entry') {
          const title = document.createElement('h1');
          title.textContent = slide.title;
          content.appendChild(title);
          
          if (slide.subtitle) {
            const subtitle = document.createElement('p');
            subtitle.textContent = slide.subtitle;
            content.appendChild(subtitle);
          }
          
          if (slide.action) {
            const button = document.createElement('button');
            button.className = 'enter-button';
            button.textContent = slide.action;
            button.onclick = () => goToSlide(1);
            content.appendChild(button);
          }
        }
        // Regular slide with heading and body
        else {
          if (slide.heading) {
            const heading = document.createElement('h2');
            heading.textContent = slide.heading;
            content.appendChild(heading);
          }
          
          if (slide.body) {
            // Handle line breaks in body text
            const paragraphs = slide.body.split('\n\n');
            paragraphs.forEach(para => {
              const p = document.createElement('p');
              // Replace single line breaks with <br> for intentional breaks
              p.innerHTML = para.split('\n').join('<span class="line-break"></span>');
              content.appendChild(p);
            });
          }
        }
        
        slideEl.appendChild(content);
        container.appendChild(slideEl);
      });
    }
    
    // ========================================
    // NAVIGATION
    // ========================================
    
    function goToSlide(index, skipAnimation = false) {
      // Bounds checking
      if (index < 0 || index >= totalSlides) return;
      
      // Prevent navigation during animation
      if (isAnimating && !skipAnimation) return;
      
      isAnimating = true;
      currentSlide = index;
      
      const container = document.getElementById('slides-container');
      const offset = -currentSlide * 100;
      
      if (skipAnimation) {
        container.style.transition = 'none';
      }
      
      container.style.transform = `translateX(${offset}vw)`;
      
      if (skipAnimation) {
        // Force reflow then restore transition
        container.offsetHeight;
        container.style.transition = '';
      }
      
      updateNavState();
      updateProgress();
      
      // Reset animation lock
      setTimeout(() => {
        isAnimating = false;
      }, 650); // Match CSS transition duration
    }
    
    function updateNavState() {
      const prevBtn = document.getElementById('prev-slide');
      const nextBtn = document.getElementById('next-slide');
      
      // Disable prev button on first slide
      prevBtn.disabled = currentSlide === 0;
      
      // Disable next button on last slide
      nextBtn.disabled = currentSlide === totalSlides - 1;
    }
    
    function updateProgress() {
      const progressBar = document.getElementById('progress-bar');
      const progress = totalSlides > 1 ? (currentSlide / (totalSlides - 1)) * 100 : 0;
      progressBar.style.width = `${progress}%`;
    }
    
    // ========================================
    // INPUT HANDLERS
    // ========================================
    
    function setupNavigation() {
      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight' || e.key === 'Right') {
          e.preventDefault();
          goToSlide(currentSlide + 1);
        } else if (e.key === 'ArrowLeft' || e.key === 'Left') {
          e.preventDefault();
          goToSlide(currentSlide - 1);
        }
      });
      
      // On-screen arrow buttons
      document.getElementById('next-slide').addEventListener('click', () => {
        goToSlide(currentSlide + 1);
      });
      
      document.getElementById('prev-slide').addEventListener('click', () => {
        goToSlide(currentSlide - 1);
      });
      
      // Trackpad horizontal scroll (with debouncing)
      let scrollTimeout;
      const container = document.getElementById('slides-container');
      
      container.addEventListener('wheel', (e) => {
        // Only respond to significant horizontal scroll
        if (Math.abs(e.deltaX) > Math.abs(e.deltaY) && Math.abs(e.deltaX) > 10) {
          e.preventDefault();
          
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(() => {
            if (e.deltaX > 30) {
              goToSlide(currentSlide + 1);
            } else if (e.deltaX < -30) {
              goToSlide(currentSlide - 1);
            }
          }, 50);
        }
      }, { passive: false });
      
      // Touch swipe for mobile
      let touchStartX = 0;
      let touchEndX = 0;
      
      container.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
      }, { passive: true });
      
      container.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      }, { passive: true });
      
      function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            // Swiped left → next slide
            goToSlide(currentSlide + 1);
          } else {
            // Swiped right → previous slide
            goToSlide(currentSlide - 1);
          }
        }
      }
    }
    
    // ========================================
    // START
    // ========================================
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>

</body>
</html>
